<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Heroku Monitoring Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}"
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü§† Heroku Monitoring Dashboard</h1>
            <p>Wrangle your apps and keep 'em running smooth on the digital frontier</p>
        </div>

        <div class="card">
            <div id="alertBox" class="alert"></div>

            <h2 style="margin-bottom: 20px; color: #3E2723; font-family: 'Georgia', 'Palatino', serif; border-bottom: 2px solid #8B4513; padding-bottom: 10px;">Current Status</h2>

            <div class="status-grid">
                <div class="status-item {{ 'active' if current_app else 'inactive' }}">
                    <h3>Monitored App</h3>
                    <p>{{ current_app or 'Not Set' }}</p>
                </div>

                <div class="status-item {{ 'active' if current_channel else 'inactive' }}">
                    <h3>Alert Channel</h3>
                    <p>{{ current_channel or 'Not Set' }}</p>
                </div>

                <div class="status-item active">
                    <h3>Check Interval</h3>
                    <p>{{ check_interval }} min</p>
                </div>

                <div class="status-item {{ 'active' if monitoring_active else 'inactive' }}">
                    <h3>Status</h3>
                    <p>
                        <span class="badge {{ 'active' if monitoring_active else 'inactive' }}">
                            {{ 'Active' if monitoring_active else 'Inactive' }}
                        </span>
                    </p>
                </div>
            </div>

            <div class="divider"></div>

            <form method="POST" action="/update-config" id="configForm">
                <div class="form-section">
                    <h2>Configure Monitoring</h2>

                    <div class="form-group">
                        <label for="app_name">App to Monitor</label>
                        <input
                            type="text"
                            id="app_name"
                            name="app_name"
                            placeholder="my-heroku-app"
                            value="{{ current_app or '' }}"
                            required
                        >
                        <small>The Heroku app you want to monitor for deploys, dyno crashes, and config changes</small>
                    </div>

                    <div class="form-group">
                        <label for="bot_app_name">Monitoring Bot App Name</label>
                        <input
                            type="text"
                            id="bot_app_name"
                            name="bot_app_name"
                            placeholder="Leave empty to auto-detect"
                            value="{{ bot_app_name or '' }}"
                        >
                        <small>The Heroku app name of this monitoring bot (usually same as app above). Leave empty for auto-detection.</small>
                    </div>

                    <div class="form-group">
                        <label for="slack_channel">Slack Channel</label>
                        <input
                            type="text"
                            id="slack_channel"
                            name="slack_channel"
                            placeholder="#alerts"
                            value="{{ current_channel or '#alerts' }}"
                            required
                        >
                        <small>Channel where alerts will be posted (include the # prefix)</small>
                    </div>

                    <div class="form-group">
                        <label for="check_interval">Check Interval (minutes)</label>
                        <input
                            type="number"
                            id="check_interval"
                            name="check_interval"
                            placeholder="5"
                            value="{{ check_interval }}"
                            min="1"
                            max="60"
                            required
                        >
                        <small>How often to check app health (1-60 minutes)</small>
                    </div>

                    <button type="submit" class="btn">Update Configuration</button>
                </div>
            </form>

            <div class="info-box">
                <p><strong>üåµ Trail Tip:</strong> Changes take effect immediately! The monitoring bot will start keeping watch over the new app and sending alerts to the specified channel faster than you can say "yeehaw!"</p>
            </div>
        </div>

        <div class="card">
            <h2 style="margin-bottom: 15px; color: #3E2723; font-family: 'Georgia', 'Palatino', serif; border-bottom: 2px solid #8B4513; padding-bottom: 10px;">Static Configuration</h2>
            <p style="color: #6D4C41; margin-bottom: 20px; font-style: italic;">These settings are configured via environment variables and require a redeploy to change.</p>

            <div class="status-grid">
                <div class="status-item {{ 'active' if heroku_api_configured else 'inactive' }}">
                    <h3>Heroku API</h3>
                    <p>
                        <span class="badge {{ 'active' if heroku_api_configured else 'inactive' }}">
                            {{ 'Configured' if heroku_api_configured else 'Not Set' }}
                        </span>
                    </p>
                </div>

                <div class="status-item {{ 'active' if slack_configured else 'inactive' }}">
                    <h3>Slack Bot Token</h3>
                    <p>
                        <span class="badge {{ 'active' if slack_configured else 'inactive' }}">
                            {{ 'Configured' if slack_configured else 'Not Set' }}
                        </span>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Check for URL parameters to show alerts
        const urlParams = new URLSearchParams(window.location.search);
        const alertBox = document.getElementById('alertBox');

        if (urlParams.get('success') === 'true') {
            alertBox.className = 'alert success show';
            alertBox.textContent = '‚úÖ Configuration updated successfully! Monitoring is now active.';

            // Remove query params from URL
            window.history.replaceState({}, document.title, window.location.pathname);
        } else if (urlParams.get('error')) {
            alertBox.className = 'alert error show';
            alertBox.textContent = '‚ùå ' + decodeURIComponent(urlParams.get('error'));

            // Remove query params from URL
            window.history.replaceState({}, document.title, window.location.pathname);
        }

        // Form submission handling
        document.getElementById('configForm').addEventListener('submit', function(e) {
            const appName = document.getElementById('app_name').value.trim();
            const channel = document.getElementById('slack_channel').value.trim();
            const checkInterval = document.getElementById('check_interval').value.trim();

            if (!appName || !channel || !checkInterval) {
                e.preventDefault();
                alertBox.className = 'alert error show';
                alertBox.textContent = '‚ùå Please fill in all fields';
                return;
            }

            const interval = parseInt(checkInterval);
            if (isNaN(interval) || interval < 1 || interval > 60) {
                e.preventDefault();
                alertBox.className = 'alert error show';
                alertBox.textContent = '‚ùå Check interval must be between 1 and 60 minutes';
            }
        });
    </script>
</body>
</html>
